{"version":3,"sources":["../../src/audio/emotion-mapper.ts","../../src/audio/audio-engine.ts","../../src/audio/effects/effects-chain.ts"],"names":[],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Emotion Mapper - Maps emotions to sound characteristics\n * Core of KAIOS's Sound Intelligence\n */\n\nimport type {\n  SentimentData,\n  AudioProfile,\n  EmotionToken,\n  SoundFrequency,\n  SoundTexture,\n  SoundRhythm\n} from '../core/types.js'\n\n/**\n * Musical descriptors for different emotional states\n */\nconst EMOTION_SOUND_MAP: Record<string, {\n  frequency: SoundFrequency\n  texture: SoundTexture\n  rhythm: SoundRhythm\n  descriptors: string[]\n}> = {\n  happy: {\n    frequency: 'high',\n    texture: 'smooth',\n    rhythm: 'fast',\n    descriptors: ['bright', 'uplifting', 'energetic', 'major key']\n  },\n  excited: {\n    frequency: 'high',\n    texture: 'rough',\n    rhythm: 'fast',\n    descriptors: ['intense', 'driving', 'euphoric', 'crescendo']\n  },\n  sad: {\n    frequency: 'low',\n    texture: 'smooth',\n    rhythm: 'slow',\n    descriptors: ['melancholic', 'minor key', 'sparse', 'atmospheric']\n  },\n  angry: {\n    frequency: 'low',\n    texture: 'rough',\n    rhythm: 'fast',\n    descriptors: ['aggressive', 'distorted', 'heavy', 'dissonant']\n  },\n  contemplative: {\n    frequency: 'mid',\n    texture: 'ambient',\n    rhythm: 'slow',\n    descriptors: ['meditative', 'spacious', 'evolving', 'textural']\n  },\n  curious: {\n    frequency: 'mid',\n    texture: 'glitchy',\n    rhythm: 'medium',\n    descriptors: ['exploratory', 'quirky', 'playful', 'unexpected']\n  },\n  surprised: {\n    frequency: 'high',\n    texture: 'glitchy',\n    rhythm: 'chaotic',\n    descriptors: ['sudden', 'dynamic', 'unpredictable', 'staccato']\n  },\n  peaceful: {\n    frequency: 'low',\n    texture: 'ambient',\n    rhythm: 'slow',\n    descriptors: ['serene', 'flowing', 'minimal', 'ethereal']\n  },\n  chaotic: {\n    frequency: 'high',\n    texture: 'chaotic',\n    rhythm: 'chaotic',\n    descriptors: ['glitchy', 'fragmented', 'intense', 'overwhelming']\n  },\n  neutral: {\n    frequency: 'mid',\n    texture: 'smooth',\n    rhythm: 'medium',\n    descriptors: ['balanced', 'steady', 'neutral', 'consistent']\n  }\n}\n\n/**\n * Map emotion token to sound map key\n */\nconst TOKEN_TO_EMOTION: Record<EmotionToken, string> = {\n  EMOTE_HAPPY: 'happy',\n  EMOTE_SAD: 'sad',\n  EMOTE_ANGRY: 'angry',\n  EMOTE_THINK: 'contemplative',\n  EMOTE_SURPRISED: 'surprised',\n  EMOTE_AWKWARD: 'neutral',\n  EMOTE_QUESTION: 'curious',\n  EMOTE_CURIOUS: 'curious',\n  EMOTE_NEUTRAL: 'neutral'\n}\n\n/**\n * Convert emotion data to sound profile\n */\nexport function emotionToSound(sentiment: SentimentData): AudioProfile {\n  const emotionKey = sentiment.emotion.toLowerCase()\n  const baseProfile = EMOTION_SOUND_MAP[emotionKey] || EMOTION_SOUND_MAP.neutral\n\n  // Adjust based on intensity\n  let texture = baseProfile.texture\n  let rhythm = baseProfile.rhythm\n\n  if (sentiment.intensity > 0.8) {\n    texture = sentiment.valence > 0 ? 'rough' : 'chaotic'\n    rhythm = 'fast'\n  } else if (sentiment.intensity < 0.3) {\n    texture = 'ambient'\n    rhythm = 'slow'\n  }\n\n  // Determine effects\n  const effects = determineEffects(sentiment)\n\n  return {\n    frequency: baseProfile.frequency,\n    texture,\n    rhythm,\n    effects,\n    energy: Math.round(sentiment.arousal * 10)\n  }\n}\n\n/**\n * Convert emotion token to sound profile\n */\nexport function tokenToSound(token: EmotionToken, intensity: number = 0.5): AudioProfile {\n  const emotionKey = TOKEN_TO_EMOTION[token]\n  const baseProfile = EMOTION_SOUND_MAP[emotionKey] || EMOTION_SOUND_MAP.neutral\n\n  return {\n    ...baseProfile,\n    effects: ['reverb', 'chorus'],\n    energy: Math.round(intensity * 10)\n  }\n}\n\n/**\n * Infer emotion from sound characteristics (reverse mapping)\n */\nexport function soundToEmotion(profile: AudioProfile): SentimentData {\n  // Calculate valence from frequency and texture\n  let valence = 0\n  if (profile.frequency === 'high') valence += 0.3\n  else if (profile.frequency === 'low') valence -= 0.2\n\n  if (profile.texture === 'smooth') valence += 0.2\n  else if (profile.texture === 'rough') valence -= 0.1\n  else if (profile.texture === 'chaotic') valence -= 0.3\n\n  // Calculate arousal from rhythm and energy\n  let arousal = profile.energy / 10\n  if (profile.rhythm === 'fast') arousal = Math.min(1, arousal + 0.2)\n  else if (profile.rhythm === 'slow') arousal = Math.max(0, arousal - 0.2)\n  else if (profile.rhythm === 'chaotic') arousal = Math.min(1, arousal + 0.3)\n\n  // Determine emotion string\n  let emotion = 'neutral'\n  if (valence > 0.2 && arousal > 0.6) emotion = 'excited'\n  else if (valence > 0.2) emotion = 'happy'\n  else if (valence < -0.2 && arousal > 0.6) emotion = 'angry'\n  else if (valence < -0.2) emotion = 'sad'\n  else if (arousal < 0.3) emotion = 'contemplative'\n  else if (profile.texture === 'glitchy') emotion = 'curious'\n\n  return {\n    emotion,\n    valence: Math.max(-1, Math.min(1, valence)),\n    arousal: Math.max(0, Math.min(1, arousal)),\n    intensity: (Math.abs(valence) + arousal) / 2\n  }\n}\n\n/**\n * Determine audio effects based on sentiment\n */\nfunction determineEffects(sentiment: SentimentData): string[] {\n  const effects: string[] = []\n\n  // Always add some reverb for spaciousness\n  effects.push('reverb')\n\n  // High intensity = more effects\n  if (sentiment.intensity > 0.6) {\n    effects.push('delay')\n  }\n\n  // High arousal = chorus for richness\n  if (sentiment.arousal > 0.5) {\n    effects.push('chorus')\n  }\n\n  // Negative valence with high intensity = distortion\n  if (sentiment.valence < -0.3 && sentiment.intensity > 0.5) {\n    effects.push('distortion')\n  }\n\n  // Chaotic emotions = glitch effects\n  if (sentiment.intensity > 0.8 || sentiment.arousal > 0.8) {\n    effects.push('glitch')\n  }\n\n  // Low arousal = more ambient processing\n  if (sentiment.arousal < 0.3) {\n    effects.push('filter')\n  }\n\n  return effects\n}\n\n/**\n * Get musical descriptors for an emotion\n */\nexport function getMusicalDescriptors(emotion: string): string[] {\n  const profile = EMOTION_SOUND_MAP[emotion.toLowerCase()]\n  return profile?.descriptors || EMOTION_SOUND_MAP.neutral.descriptors\n}\n\n/**\n * Build a music generation prompt from sentiment\n */\nexport function buildMusicPrompt(sentiment: SentimentData, style: string): string {\n  const profile = emotionToSound(sentiment)\n  const emotionKey = sentiment.emotion.toLowerCase()\n  const descriptors = getMusicalDescriptors(emotionKey)\n\n  const parts = [\n    style,\n    'track',\n    ...descriptors,\n    `${sentiment.emotion} mood`,\n    'experimental electronic',\n    profile.texture === 'glitchy' ? 'glitchy textures' : '',\n    profile.texture === 'ambient' ? 'ambient soundscape' : '',\n    profile.rhythm === 'fast' ? 'driving rhythm' : '',\n    profile.rhythm === 'slow' ? 'slow tempo' : '',\n    profile.frequency === 'low' ? 'deep bass' : '',\n    profile.frequency === 'high' ? 'bright highs' : ''\n  ].filter(Boolean)\n\n  return parts.join(', ')\n}\n\n/**\n * Map frequency to Hz range\n */\nexport function frequencyToHz(freq: SoundFrequency): { min: number; max: number } {\n  switch (freq) {\n    case 'low':\n      return { min: 60, max: 250 }\n    case 'mid':\n      return { min: 250, max: 2000 }\n    case 'high':\n      return { min: 2000, max: 8000 }\n    default:\n      return { min: 250, max: 2000 }\n  }\n}\n\n/**\n * Get BPM range for rhythm\n */\nexport function rhythmToBPM(rhythm: SoundRhythm): { min: number; max: number } {\n  switch (rhythm) {\n    case 'slow':\n      return { min: 60, max: 90 }\n    case 'medium':\n      return { min: 90, max: 130 }\n    case 'fast':\n      return { min: 130, max: 180 }\n    case 'chaotic':\n      return { min: 80, max: 200 } // Variable\n    default:\n      return { min: 90, max: 130 }\n  }\n}\n","/**\n * Audio Engine - Core sound intelligence processing\n * Handles audio generation, effects, and sound synthesis\n */\n\nimport type {\n  SentimentData,\n  AudioProfile,\n  GeneratedAudio,\n  AudioConfig\n} from '../core/types.js'\nimport { emotionToSound, buildMusicPrompt } from './emotion-mapper.js'\n\nexport interface AudioEngineConfig extends AudioConfig {\n  sampleRate?: number\n  channels?: number\n}\n\n/**\n * Main audio engine for Sound Intelligence\n */\nexport class AudioEngine {\n  private config: AudioEngineConfig\n  private audioContext: AudioContext | null = null\n  private isInitialized = false\n\n  constructor(config: AudioEngineConfig) {\n    this.config = {\n      sampleRate: 44100,\n      channels: 2,\n      ...config\n    }\n  }\n\n  /**\n   * Initialize audio context (must be called after user interaction in browser)\n   */\n  async initialize(): Promise<void> {\n    if (this.isInitialized) return\n\n    if (typeof AudioContext !== 'undefined') {\n      this.audioContext = new AudioContext({\n        sampleRate: this.config.sampleRate\n      })\n      this.isInitialized = true\n    } else {\n      console.warn('AudioContext not available in this environment')\n    }\n  }\n\n  /**\n   * Map emotions to sound characteristics\n   */\n  mapEmotionToSound(params: {\n    emotion: string\n    valence: number\n    arousal: number\n    intensity: number\n  }): AudioProfile {\n    const sentiment: SentimentData = {\n      emotion: params.emotion,\n      valence: params.valence,\n      arousal: params.arousal,\n      intensity: params.intensity\n    }\n\n    return emotionToSound(sentiment)\n  }\n\n  /**\n   * Generate sentiment-driven music\n   * In production, this would integrate with audio generation APIs\n   */\n  async generateMusic(params: {\n    sentiment: SentimentData\n    style: string\n    duration: number\n  }): Promise<GeneratedAudio | null> {\n    if (!this.config.musicGeneration) {\n      return null\n    }\n\n    // Build prompt for music generation\n    const prompt = buildMusicPrompt(params.sentiment, params.style)\n\n    // In production, this would call an audio generation API\n    // (e.g., Stable Audio, MusicGen, etc.)\n    console.log('Music generation prompt:', prompt)\n\n    return {\n      metadata: {\n        sentiment: params.sentiment,\n        style: params.style,\n        duration: params.duration,\n        timestamp: Date.now()\n      }\n    }\n  }\n\n  /**\n   * Generate a simple tone based on emotion\n   * This is a basic example - real implementation would be more sophisticated\n   */\n  async generateTone(params: {\n    frequency: number\n    duration: number\n    type?: OscillatorType\n  }): Promise<void> {\n    if (!this.audioContext) {\n      await this.initialize()\n    }\n\n    if (!this.audioContext) {\n      throw new Error('AudioContext not available')\n    }\n\n    const oscillator = this.audioContext.createOscillator()\n    const gainNode = this.audioContext.createGain()\n\n    oscillator.type = params.type || 'sine'\n    oscillator.frequency.value = params.frequency\n\n    oscillator.connect(gainNode)\n    gainNode.connect(this.audioContext.destination)\n\n    // Envelope\n    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime)\n    gainNode.gain.linearRampToValueAtTime(0.3, this.audioContext.currentTime + 0.1)\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      this.audioContext.currentTime + params.duration\n    )\n\n    oscillator.start()\n    oscillator.stop(this.audioContext.currentTime + params.duration)\n  }\n\n  /**\n   * Play a sound effect based on emotion\n   */\n  async playSoundEffect(emotion: string, intensity: number = 0.5): Promise<void> {\n    const profile = this.mapEmotionToSound({\n      emotion,\n      valence: emotion === 'happy' ? 0.5 : emotion === 'sad' ? -0.5 : 0,\n      arousal: intensity,\n      intensity\n    })\n\n    // Map frequency range to Hz\n    const freqMap = {\n      low: 220,\n      mid: 440,\n      high: 880\n    }\n\n    const freq = freqMap[profile.frequency] || 440\n\n    // Map texture to oscillator type\n    const typeMap: Record<string, OscillatorType> = {\n      smooth: 'sine',\n      rough: 'sawtooth',\n      glitchy: 'square',\n      ambient: 'triangle',\n      chaotic: 'square'\n    }\n\n    const type = typeMap[profile.texture] || 'sine'\n\n    await this.generateTone({\n      frequency: freq,\n      duration: 0.5,\n      type\n    })\n  }\n\n  /**\n   * Get current capabilities\n   */\n  getCapabilities(): {\n    musicGeneration: boolean\n    voiceSynthesis: boolean\n    spatialAudio: boolean\n    effectsChain: string[]\n  } {\n    return {\n      musicGeneration: this.config.musicGeneration || false,\n      voiceSynthesis: this.config.voiceSynthesis || false,\n      spatialAudio: this.config.spatialAudio || false,\n      effectsChain: ['reverb', 'delay', 'chorus', 'distortion', 'glitch', 'filter']\n    }\n  }\n\n  /**\n   * Suspend audio context (save resources)\n   */\n  async suspend(): Promise<void> {\n    if (this.audioContext && this.audioContext.state === 'running') {\n      await this.audioContext.suspend()\n    }\n  }\n\n  /**\n   * Resume audio context\n   */\n  async resume(): Promise<void> {\n    if (this.audioContext && this.audioContext.state === 'suspended') {\n      await this.audioContext.resume()\n    }\n  }\n\n  /**\n   * Clean up resources\n   */\n  dispose(): void {\n    if (this.audioContext) {\n      this.audioContext.close()\n      this.audioContext = null\n      this.isInitialized = false\n    }\n  }\n}\n","/**\n * Effects Chain - Audio effects processing for Sound Intelligence\n * Provides reverb, delay, glitch, and other effects\n */\n\nexport interface EffectParams {\n  name: string\n  params: Record<string, number>\n}\n\nexport interface ReverbParams {\n  roomSize: number // 0-1\n  damping: number // 0-1\n  wetDry: number // 0-1\n}\n\nexport interface DelayParams {\n  time: number // seconds\n  feedback: number // 0-1\n  wetDry: number // 0-1\n}\n\nexport interface GlitchParams {\n  amount: number // 0-1\n  type: 'stutter' | 'bitcrush' | 'tape'\n}\n\nexport interface ChorusParams {\n  rate: number // Hz\n  depth: number // 0-1\n  wetDry: number // 0-1\n}\n\nexport interface DistortionParams {\n  amount: number // 0-1\n  type: 'soft' | 'hard' | 'fuzz'\n}\n\n/**\n * Audio effects chain processor\n */\nexport class EffectsChain {\n  private audioContext: AudioContext | null = null\n  private effects: Map<string, AudioNode> = new Map()\n\n  constructor(audioContext?: AudioContext) {\n    this.audioContext = audioContext || null\n  }\n\n  /**\n   * Set audio context\n   */\n  setContext(context: AudioContext): void {\n    this.audioContext = context\n  }\n\n  /**\n   * Apply reverb effect\n   */\n  async applyReverb(\n    inputNode: AudioNode,\n    params: ReverbParams\n  ): Promise<AudioNode> {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    // Create convolver for reverb\n    const convolver = this.audioContext.createConvolver()\n\n    // Generate impulse response\n    const impulseResponse = this.generateImpulseResponse(\n      this.audioContext,\n      params.roomSize * 3, // Duration in seconds\n      params.damping\n    )\n    convolver.buffer = impulseResponse\n\n    // Create wet/dry mix\n    const dryGain = this.audioContext.createGain()\n    const wetGain = this.audioContext.createGain()\n    const output = this.audioContext.createGain()\n\n    dryGain.gain.value = 1 - params.wetDry\n    wetGain.gain.value = params.wetDry\n\n    inputNode.connect(dryGain)\n    inputNode.connect(convolver)\n    convolver.connect(wetGain)\n\n    dryGain.connect(output)\n    wetGain.connect(output)\n\n    this.effects.set('reverb', convolver)\n\n    return output\n  }\n\n  /**\n   * Apply delay effect\n   */\n  applyDelay(\n    inputNode: AudioNode,\n    params: DelayParams\n  ): AudioNode {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    const delay = this.audioContext.createDelay(5)\n    delay.delayTime.value = params.time\n\n    const feedback = this.audioContext.createGain()\n    feedback.gain.value = params.feedback\n\n    const dryGain = this.audioContext.createGain()\n    const wetGain = this.audioContext.createGain()\n    const output = this.audioContext.createGain()\n\n    dryGain.gain.value = 1 - params.wetDry\n    wetGain.gain.value = params.wetDry\n\n    // Connect delay feedback loop\n    inputNode.connect(delay)\n    delay.connect(feedback)\n    feedback.connect(delay)\n\n    // Mix dry and wet\n    inputNode.connect(dryGain)\n    delay.connect(wetGain)\n\n    dryGain.connect(output)\n    wetGain.connect(output)\n\n    this.effects.set('delay', delay)\n\n    return output\n  }\n\n  /**\n   * Apply chorus effect\n   */\n  applyChorus(\n    inputNode: AudioNode,\n    params: ChorusParams\n  ): AudioNode {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    // Create modulated delay for chorus\n    const delay1 = this.audioContext.createDelay()\n    const delay2 = this.audioContext.createDelay()\n\n    delay1.delayTime.value = 0.02\n    delay2.delayTime.value = 0.025\n\n    // LFO for modulation\n    const lfo = this.audioContext.createOscillator()\n    const lfoGain = this.audioContext.createGain()\n\n    lfo.frequency.value = params.rate\n    lfoGain.gain.value = params.depth * 0.002\n\n    lfo.connect(lfoGain)\n    lfoGain.connect(delay1.delayTime)\n\n    // Create another LFO slightly detuned\n    const lfo2 = this.audioContext.createOscillator()\n    const lfo2Gain = this.audioContext.createGain()\n\n    lfo2.frequency.value = params.rate * 1.1\n    lfo2Gain.gain.value = params.depth * 0.002\n\n    lfo2.connect(lfo2Gain)\n    lfo2Gain.connect(delay2.delayTime)\n\n    // Mix\n    const dryGain = this.audioContext.createGain()\n    const wetGain = this.audioContext.createGain()\n    const output = this.audioContext.createGain()\n\n    dryGain.gain.value = 1 - params.wetDry\n    wetGain.gain.value = params.wetDry * 0.5\n\n    inputNode.connect(dryGain)\n    inputNode.connect(delay1)\n    inputNode.connect(delay2)\n    delay1.connect(wetGain)\n    delay2.connect(wetGain)\n\n    dryGain.connect(output)\n    wetGain.connect(output)\n\n    lfo.start()\n    lfo2.start()\n\n    this.effects.set('chorus', delay1)\n\n    return output\n  }\n\n  /**\n   * Apply distortion effect\n   */\n  applyDistortion(\n    inputNode: AudioNode,\n    params: DistortionParams\n  ): AudioNode {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    const waveshaper = this.audioContext.createWaveShaper()\n\n    // Generate distortion curve based on type\n    waveshaper.curve = this.generateDistortionCurve(params.amount, params.type)\n    waveshaper.oversample = '4x'\n\n    inputNode.connect(waveshaper)\n\n    this.effects.set('distortion', waveshaper)\n\n    return waveshaper\n  }\n\n  /**\n   * Apply glitch/stutter effect\n   */\n  applyGlitch(\n    inputNode: AudioNode,\n    params: GlitchParams\n  ): AudioNode {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    // For glitch, we use a combination of effects\n    if (params.type === 'bitcrush') {\n      return this.applyBitcrush(inputNode, params.amount)\n    }\n\n    // Stutter effect using rapid gain modulation\n    const gain = this.audioContext.createGain()\n    inputNode.connect(gain)\n\n    // Create stutter LFO\n    const lfo = this.audioContext.createOscillator()\n    const lfoGain = this.audioContext.createGain()\n\n    lfo.type = 'square'\n    lfo.frequency.value = 4 + params.amount * 16 // 4-20 Hz\n    lfoGain.gain.value = params.amount\n\n    lfo.connect(lfoGain)\n    lfoGain.connect(gain.gain)\n\n    lfo.start()\n\n    this.effects.set('glitch', gain)\n\n    return gain\n  }\n\n  /**\n   * Adjust an effect's parameters\n   */\n  adjustEffect(name: string, params: Record<string, number>): void {\n    const effect = this.effects.get(name)\n    if (!effect) {\n      console.warn(`Effect '${name}' not found`)\n      return\n    }\n\n    // Apply parameter changes based on effect type\n    if (effect instanceof GainNode && params.gain !== undefined) {\n      effect.gain.value = params.gain\n    }\n\n    if (effect instanceof DelayNode && params.time !== undefined) {\n      effect.delayTime.value = params.time\n    }\n  }\n\n  /**\n   * Remove all effects\n   */\n  clear(): void {\n    this.effects.clear()\n  }\n\n  /**\n   * Dispose of all resources\n   */\n  dispose(): void {\n    this.effects.clear()\n    this.audioContext = null\n  }\n\n  // ═══════════════════════════════════════════════════════════════════════════════\n  // PRIVATE METHODS\n  // ═══════════════════════════════════════════════════════════════════════════════\n\n  private generateImpulseResponse(\n    context: AudioContext,\n    duration: number,\n    decay: number\n  ): AudioBuffer {\n    const sampleRate = context.sampleRate\n    const length = sampleRate * duration\n    const buffer = context.createBuffer(2, length, sampleRate)\n\n    for (let channel = 0; channel < 2; channel++) {\n      const channelData = buffer.getChannelData(channel)\n\n      for (let i = 0; i < length; i++) {\n        const t = i / sampleRate\n        const envelope = Math.exp(-t * (1 + decay * 5))\n        channelData[i] = (Math.random() * 2 - 1) * envelope\n      }\n    }\n\n    return buffer\n  }\n\n  private generateDistortionCurve(\n    amount: number,\n    type: 'soft' | 'hard' | 'fuzz'\n  ): Float32Array<ArrayBuffer> {\n    const samples = 44100\n    const curve = new Float32Array(samples) as Float32Array<ArrayBuffer>\n    const k = amount * 100\n\n    for (let i = 0; i < samples; i++) {\n      const x = (i * 2) / samples - 1\n\n      switch (type) {\n        case 'soft':\n          // Soft clipping\n          curve[i] = Math.tanh(k * x)\n          break\n        case 'hard':\n          // Hard clipping\n          curve[i] = Math.max(-1, Math.min(1, k * x))\n          break\n        case 'fuzz':\n          // Asymmetric fuzz\n          curve[i] = Math.sign(x) * Math.pow(Math.abs(Math.tanh(k * x)), 0.5)\n          break\n        default:\n          curve[i] = x\n      }\n    }\n\n    return curve\n  }\n\n  private applyBitcrush(inputNode: AudioNode, amount: number): AudioNode {\n    if (!this.audioContext) {\n      throw new Error('AudioContext not set')\n    }\n\n    // Simulate bitcrushing using sample rate reduction\n    // This is a simplified version - real bitcrushing would use a ScriptProcessor or AudioWorklet\n\n    const filter = this.audioContext.createBiquadFilter()\n    filter.type = 'lowpass'\n    filter.frequency.value = 22050 - amount * 20000 // Reduce high frequencies\n\n    inputNode.connect(filter)\n\n    return filter\n  }\n}\n"]}